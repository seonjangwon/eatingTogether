<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link href="/css/layout2.css" rel="stylesheet" crossorigin="anonymous">
    <meta charset="UTF-8">
    <meta name="_csrf" th:content="${_csrf.token}">
    <meta name="_csrf_header" th:content="${_csrf.headerName}">
    <title>[ë­ë¨¹ì„ê¹Œìš”:ì—…ì²´] ì£¼ë¬¸í˜„í™©ìƒì„¸ </title>
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>

</head>
<style>
    a {
        text-decoration-line: none;
    }

    /* í•˜ì´í¼ë§í¬ ê¾¸ë°ˆìš”ì†Œ ì‚­ì œ */
    a:link {
        color: sandybrown;
    }

    /* í•˜ì´í¼ë§í¬ ê´€ë ¨ */
    a:visited {
        color: sandybrown;
    }

    a:hover {
        color: coral;
    }

    a:active {
        color: deeppink;
    }
</style><!-- í•˜ì´í¼ë§í¬ìš©: ìˆ˜ì •ê°€ëŠ¥ì„± ìˆìŒ -->
<body>
<header>
    <div class="container">
        <div class="row">
            <div class="col-3">
                <span id=logoTitle>
                    <h3><a href="/"> ğŸ™ ë­ë¨¹ì„ê¹Œìš”?</a></h3>
                </span>
            </div>
            <div class="col-2">
                <!-- ê³µë°±ë€ -->
            </div>
            <div class="col-2">
                <!--<form class="d-flex" id="menuBar-search">
                  <input class="form-control me-sm-2" type="text" placeholder="Search">
                  <button class="btn btn-secondary my-2 my-sm-0" type="submit">Search</button>
                </form>-->
            </div>
            <div class="col-4">
                <span id="menuBar-text">
                    ë§ˆì´í˜ì´ì§€ ì£¼ë¬¸ë‚´ì—­ ì°œë‚´ì—­
                </span>
            </div>
            <div class="col" id="menuBar-friPan">
                <a href="#" class="btn btn-light btn-sm " tabindex="-1" role="button" aria-disabled="true">ğŸ³</a>
                <!--<button class="btn btn-right" id="menuBar-offCanvas" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight" aria-controls="offcanvasRight">ğŸ³</button>-->
            </div>
        </div>
    </div>
</header><!--header í—·ê°ˆë¦¬ë‹ˆê¹Œ ì ‘ì–´ë‘ê³  ì‚¬ìš©í•˜ê¸°! ì´ë™í•  menu text & link ì²´í¬í•´ì£¼ì„¸ìš”~-->
<section>
    <div class="container-section">
        <div class="leftMenuBar">
            <p><a th:href="@{|/store/orderAll/${session['storeLoginEmail']}|}">ì˜¤ëŠ˜ì˜ ì£¼ë¬¸</a></p><br>
            <p><a href="/storeMain">ë©”ì¸ìœ¼ë¡œ</a></p><br>
        </div>
        <div class="orderInfo">
            <div class="item" id="OrderNow">
                <li>
                    <ul>
                        <li>ë°°ë‹¬ìƒíƒœ</li>
                        <p th:text="${order.orderNow}"></p>
                        <li>ì—…ì²´ëª…</li>
                        <p th:text="${order.storeName}"></p>
                        <li>ì£¼ë¬¸ë‚ ì§œ</li>
                        <p th:text="${order.orderTime}"></p>
                        <li>ì£¼ë¬¸ë²ˆí˜¸</li>
                        <p th:text="${order.orderNumber}"></p>
                    </ul>
                </li>

            </div>
            <div class="item" id="requestByCustomer">
                <li>
                    <ul>
                        <li>ì´ê¸ˆì•¡</li>
                        <p th:text="${order.orderPrice}"></p>
                        <li>ê²°ì œ ë°©ë²•</li>
                        <p th:text="${order.orderType}"></p>
                        <li>ì£¼ì†Œ</li>
                        <p th:text="${customer.customerAddress}"></p>
                        <li>ë²ˆí˜¸</li>
                        <p th:text="${customer.customerPhone}"></p>
                        <li>ì‚¬ì¥ë‹˜ê»˜</li>
                        <p th:text="${order.orderTomaster}"></p>
                        <li>ë¼ì´ë”ë‹˜ê»˜</li>
                        <p th:text="${order.orderTorider}"></p>
                    </ul>
                </li>
            </div>
            <div class="item" id="Menu">
                <ul th:each="m :${menu}">
                    <li th:text="${m.menuName}"></li>
                    <li th:text="${m.orderMenuCount}"></li>
                    <li th:text="${m.orderMenuPrice}"></li>
                </ul>
            </div>
            <div class="item" id="helloRider">
                <div th:if="${order.orderNow == 'ì ‘ìˆ˜ ëŒ€ê¸°'}">
                    <input type="button" value="ë°°ë‹¬ìš”ì²­" id="riderSelect" onclick="popUp()">
                </div>
                <div th:if="${order.orderNow == 'ë°°ë‹¬ì¤‘'}">
                    <input type="button" value="ë°°ë‹¬ ì™„ë£Œ ìš”ì²­" onclick="rider_end_btn()">
                </div>
                <span id="plz" style="display: none"> ë°°ë‹¬ìš”ì²­ ì‹¤í–‰í•˜ë©´ ë‚˜ì˜µë‹ˆë‹¤ </span>
                <a th:href="@{|/store/orderAll/${session['storeLoginEmail']}|}" class="btn btn-light btn-sm"
                   tabindex="-1" id="orderFinish" role="button" style="display:none;" aria-disabled="true"> ì²˜ë¦¬ì™„ë£Œ </a>
                <!--<input type="button" value="ì£¼ë¬¸ì²˜ë¦¬" id="orderFinish" style="display:none;" on="">-->
            </div>
        </div>
    </div>
</section>
<div id="msgStack"></div>
<footer>
    'ë­ë¨¹ì„ê¹Œìš”-ET' ëŠ” ì†Œìƒê³µì¸ì„ ì‘ì›í•©ë‹ˆë‹¤.
</footer><!--footer ë‚´ìš©ê³ ì • (ë³€ê²½í•  ë©˜íŠ¸ ìˆìœ¼ì‹œë©´ ì ì–´ì£¼ì…”ë„ ë©ë‹ˆë‹¹)-->
</body>

<script>
    const rider_end_btn = () =>{
        const orderNumber = '[[${order.orderNumber}]]';
        var header = $("meta[name='_csrf_header']").attr('content');
        var token = $("meta[name='_csrf']").attr('content');
        $.ajax({
            type:'put',
            url:'/store/rider',
            data:{"orderNumber":orderNumber},
            dataType:'text',
            beforeSend: function(xhr){
                xhr.setRequestHeader(header, token);
            },
            success:function (result){
                console.log(result);
                if (result==="ok"){
                    alert("ë°°ë‹¬ ì™„ë£Œ ì„±ê³µ")
                    location.reload();
                } else  {
                    alert("ì˜¤ë¥˜!")
                }
            },
            error:function (){
                alert("ì•„ì‘ì•„ì‘");
            }
        });
    }
    //íŒì—…ì„ í•©ë‹ˆë‹¤.
    function popUp() {
        const orderNum = '[[${order.orderNumber}]]';
        window.open("/store/riderList/" + orderNum, "riderList", "width=400, height=300, left=100, top=50");
        console.log("íŒì—…ëˆ„ë¦„");
    }

    //íŒì—…ì°½ì˜ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
    function getPopupData(riderNumber, riderName) {
        const plz = document.getElementById('plz');
        plz.innerHTML = riderName + "ë‹˜ê»˜ ë°°ë‹¬ì¶œë°œìš”ì²­ í•˜ì˜€ìŠµë‹ˆë‹¤.";

        $("#plz").show();
        $("#riderSelect").hide();
        $("#orderFinish").show();

    }

</script>
<script src="/js/webSocket.js"></script>
</html>