<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <meta charset="UTF-8">
  <title>[뭐먹을까요:업체] 메뉴수정</title>
  <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
  <script>
    /*const updateMenu_btn = () => {
      let menuUpdateData = new FormData($('#updateMenuForm'));
      /!*let menuUpdateData = new FormData();*!/
/!*      let menuUpdateData = new FormData(document.getElementById('updateForm'));
      menuUpdateData.append("menuNumber",$('#menu_number').val());
      menuUpdateData.append("menuName",$('#menu_name').val());
      menuUpdateData.append("menuExplain",$('#menu_explain').val());
      menuUpdateData.append("menuPrice",$('#menu_price').val());
      menuUpdateData.append("menuFilename",$('#menu_filename')[0]);*!/
      //새로운 form #updateForm에 [0] = 1개의 데이터를 담아 menuUpdateData에 넣음
      const id = document.querySelector('#menuNumber');
      console.log(menuUpdateData);

      $.ajax ({
        type: 'put',
        url: '/store/update/' + id, // localhost/store/update/{menuNumber} 형식
        precessData: false,
        contentType: false,
        cache: false,
        data: menuUpdateData,
        success: function ()  {
          location.href = "/store/update/";
          console.log("menuUpdateBtn 성공")
        }, error : function ()  {
          alert("ajax 아작아작")
        }
      });
    }*/

    const updateMenu_btn = () =>{
       let menu = new FormData();
      /*let menu = JSON.stringify({
        menuNumber: document.getElementById('menuNumber').value,
        menuName: document.getElementById('menuName').value,
        menuPrice: document.getElementById('menuPrice').value,
        menuExplain: document.getElementById('menuExplain').value,
        // menuFile: document.getElementById('menuFile')
        //menuFile: $("#menuFile")[0]
        });
      const file = $("#menuFile")[0]*/
      menu.append("menuNumber",$("#menuNumber").val());
      menu.append("menuName",$("#menuName").val());
      menu.append("menuExplain",$("#menuExplain").val());
      menu.append("menuPrice",$("#menuPrice").val());
      menu.append("menuFile",document.getElementById('menuFile').files[0]);
      menu.append("storeNumber",$("#storeNumber").val());
      menu.append("storeCategoryNumber",$("#storeCategoryNumber").val());
      // menu.append("menuFile",$("#menuFile")[0]);
      /*console.log(menu.get("menuNumber"));
      console.log(menu.get("menuName"));
      console.log(menu);
      /*const id = document.querySelector('#menuNumber');*/
      /*const id = document.getElementById(menu.get("menuNumber"));*/

      $.ajax({
        type: 'put',
        url: '/store/update',
        data: menu,
        processData : false,
        contentType : false,
        enctype: 'multipart/form-data',
        cache: false,
        dataType: 'text',
        success: function (result)  {
          console.log(result);
          if(result==="ok"){
            location.href="/store/"+ '[[${menu.storeNumber}]]';
          }
          //location.href = result;
        },
        error: function ()  {
          alert("ajax를 실패했어...")
        }

      });
    }


  </script>

</head>
<body>

  <section id="menuUpdate">
  <span th:text="${session['storeLoginEmail']}"}> </span>
  님
    <h4> <span th:text="*{menu.menuName}"> </span> 메뉴 수정 </h4>

    <form id="updateMenuForm" >

      <input type="hidden" id="menuNumber" th:value="${menu.menuNumber}">
      <input type="text" id="menuName" name="menuName" th:value="${menu.menuName}" placeholder="메뉴이름"><br>
      <input type="text" id="menuExplain" name="menuExplain" th:value="${menu.menuExplain}" placeholder="메뉴설명"><br>
      <input type="text" id="menuPrice" name="menuPrice" th:value="${menu.menuPrice}" placeholder="가격"><br>
      <input type="file" id="menuFile" name="menuFile" placeholder="메뉴사진"><br>
      <img th:src="@{|/upload/store/${menu.menuFile}|}" alt="사진"><br>
      <input type="hidden" name="storeNumber" id="storeNumber" th:value="${menu.storeNumber}"><br>
      <input type="hidden" name="storeCategoryNumber" id="storeCategoryNumber" th:value="${menu.storeCategoryNumber}"><br>
    </form>
    <input type="button" value="수정버튼" onclick="updateMenu_btn()">
    <!--<button th:onclick="updateMenu_btn1([[${menu.menuNumber}]])"> 수정ajax</button>-->
  </section>


</body>
</html>