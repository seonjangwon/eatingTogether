<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <link href="/css/layout1.css" rel="stylesheet" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <meta charset="UTF-8">
    <meta name="_csrf" th:content="${_csrf.token}">
    <meta name="_csrf_header" th:content="${_csrf.headerName}">
    <title>[ë­ë¨¹ì„ê¹Œìš”:ì—…ì²´] ë§¤ì¥í˜ì´ì§€ </title>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
            crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script>
        const basket_view = (menuNumber) => {
            const view = document.getElementById('modal-body');
            var header = $("meta[name='_csrf_header']").attr('content');
            var token = $("meta[name='_csrf']").attr('content');

            $.ajax({
                type: "get",
                url: '/customer/menu',
                data: {"menuNumber": menuNumber},
                dataType: 'json',
                beforeSend: function (xhr) {
                    xhr.setRequestHeader(header, token);
                },
                success: function (result) {
                    console.log(result);

                    let output = "<div class='row'>" +
                        "<div class='menuInfo' style='display: flex' >" + result.menuExplain + '&nbsp;' + result.menuPrice + "</div> " + "\n" +
                        /*"<div class='col-3'><button class='btn btn-black-50' onclick='menuCountDown()'>-</button>" +*/
                        "<div class='countBtn mb-10px' style='display: flex'><button class='btn btn-black-50' onclick='menuCountDown()'>-</button>" +
                        "<input type='number' id='menuCount' value='1' readonly>" +
                        "<button class='btn btn-black-50' onclick='menuCountUp()'>+</button>" +
                        "</div>" +
                        "<button class='btn btn-secondary' onclick='basketAdd(" + result.menuNumber + ")'>ì¥ë°”êµ¬ë‹ˆì— ë©”ë‰´ ì¶”ê°€</button>" +
                        "</div>";
                    view.innerHTML = output;
                },
                error: function () {
                    alert("ì•„ì‘ì•„ì‘");
                }
            });
        }
        const menuCountDown = () => {
            let value = document.getElementById('menuCount');
            let value1 = document.getElementById('menuCount');
            console.log(value);
            if (value.value == 1) {
                alert("ë” ì´ìƒ ì¤„ì¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤")
            } else {
                value1.value = (parseInt(value.value) - 1);
                console.log(value1);
            }
        }
        const menuCountUp = () => {
            let value = document.getElementById('menuCount');
            let value1 = document.getElementById('menuCount');
            console.log(value.value);
            value1.value = (parseInt(value.value) + parseInt("1"));
            console.log(value1.value);
        }
        const basketAdd = (menuNumber) => {
            const value = document.getElementById('menuCount').value; // ë©”ë‰´ ê°¯ìˆ˜

            var header = $("meta[name='_csrf_header']").attr('content');
            var token = $("meta[name='_csrf']").attr('content');

            console.log(menuNumber);
            console.log(value);

            $.ajax({
                type: 'post',
                url: '/customer/basket',
                data: {"menuNumber": menuNumber, "menuCount": value},
                dataType: "text",
                beforeSend: function (xhr) {
                    xhr.setRequestHeader(header, token);
                },
                success: function (result) {
                    console.log(result);
                    if (result === "ok") {
                        alert("ì¥ë°”êµ¬ë‹ˆì— ë‹´ì•˜ìŠµë‹ˆë‹¤");
                    } else if (result === "no") {
                        alert("ì´ë¯¸ ìˆëŠ” ìƒí’ˆì…ë‹ˆë‹¤")
                    } else if (result === "other") {
                        alert("ê°™ì€ ì—…ì²´ì˜ ë©”ë‰´ë§Œ ë‹´ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤")
                    }

                    document.getElementById('modal_close').click();
                },
                error: function () {
                    alert("ì•„ì‘ì•„ì‘ì•„ì‘");
                }
            });
            value.value = 0;
        }
        const wishlist_add_btn = (storeNumber) => {
            var header = $("meta[name='_csrf_header']").attr('content');
            var token = $("meta[name='_csrf']").attr('content');
            $.ajax({
                type: 'post',
                url: '/store/wishList',
                data: {"storeNumber": storeNumber},
                dataType: 'text',
                beforeSend: function (xhr) {
                    xhr.setRequestHeader(header, token);
                },
                success: function (result) {
                    if (result === "ok") {
                        alert("ì°œ ë“±ë¡ ì™„ë£Œ!")
                    } else if (result === "no") {
                        alert("ì´ë¯¸ ë“±ë¡ëœ ì—…ì²´ì…ë‹ˆë‹¤!")
                    } else {
                        alert("ì˜¤ë¥˜!")
                    }
                },
                error: function () {
                    alert("ì•„ì‘ì•„ì‘")
                }
            });
        }
    </script>
</head>
<style>
    a {
        text-decoration-line: none;
    }

    /* í•˜ì´í¼ë§í¬ ê¾¸ë°ˆìš”ì†Œ ì‚­ì œ */
    a:link {
        color: sandybrown;
    }

    /* í•˜ì´í¼ë§í¬ ê´€ë ¨ */
    a:visited {
        color: sandybrown;
    }

    a:hover {
        color: coral;
    }

    a:active {
        color: deeppink;
    }

    #storeDataView {
        font-family: 'LeeSeoyun';
        border: 0.5px solid;
        border-color: coral;
        border-radius: 0.5rem;
        margin: 5px;
        min-height: 100px;
        max-height: 270px;
        display: grid;
        /*grid-template-columns: 1fr 3fr;*/
        grid-template-rows: 1fr 0.3fr;
        padding-top: 10px;
        padding-bottom: 10px;
    }

    /*#store {
        margin-bottom: 30px;
    }*/

    #sAll {
        display: grid;
        grid-template-columns: 1fr 3fr;
    }

    #sInfo {
        font-size: 20px;
    }

    #mrBtn {
        transform: translate(0%, 30%);
        height: 40px;
    }

    #menuBtn {
        font-family: 'LeeSeoyun';
        color: blanchedalmond;
        font-weight: bold;
        text-align: center;
        height: 30px;
    }

    #reviewBtn {
        font-family: 'LeeSeoyun';
        color: blanchedalmond;
        font-weight: bold;
        text-align: center;
        height: 30px;
    }

    .contents {
        width: 100%;
        /*transform: translate(50%, 0%);*/
        background-color: blanchedalmond;
        border-radius: 0.5rem;
        font-family: 'LeeSeoyun';
        margin: 5px;
        /*min-height: 100px;*/
        display: grid;
        /*grid-template-rows: 1fr 0.5fr;*/
        padding-top: 10px;
        padding-bottom: 10px;
    }

    #reviewArea1 {
        display: grid;
        grid-template-columns: 1fr 3fr;
        transform: translate(4%);
        width: 96%;
        min-height: 150px;
        padding: 3px;
        background-color: blanchedalmond;
        border-radius: 0.5rem;
        margin-bottom: 5px;
    }

    #commentArea {
        width: 96%;
        display: flex;
        transform: translate(4%);
        justify-content: center;
        align-items: center;
        min-height: 50px;
        padding: 3px;
        background-color: azure;
        border-radius: 0.5rem;
        margin-bottom: 5px;
    }

    #review1 {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    #review2 {
        display: grid;
        grid-template-rows: 1fr 2fr;
        justify-content: center;
        align-items: center;
    }

    .t012 {
        display: grid;
        grid-template-columns: 2fr 1fr;
    }

    #1 {
        text-align: left;
        font-size: large;
    }

    #time {
        text-align: right;
        font-size: medium;
    }

    .ment {
        height: 50px;
        margin-bottom: 10px;
    }

</style><!-- í•˜ì´í¼ë§í¬ìš©: ìˆ˜ì •ê°€ëŠ¥ì„± ìˆìŒ -->
<body>
<header>
    <div class="container">
        <div class="row">
            <div class="col-3">
                <span id=logoTitle>
                    <h3><a href="/"> ğŸ™ ë­ë¨¹ì„ê¹Œìš”?</a></h3>
                </span>
            </div>
            <div class="col-2">
                <!-- ê³µë°±ë€ -->
            </div>
            <div class="col-2">
            </div>
            <div class="col-4">
                <span id="menuBar-text">
                     <div th:if="${session.customerLoginEmail == null && session.storeLoginEmail == null}"><!-- ë¡œê·¸ì¸ ì—†ìŒ-->
                         ë­ë¨¹ì„ê¹Œìš”, eating together!
                     </div>
                    <div th:if="${session.customerLoginEmail}">
                        <a href="/usual/logout"> ë¡œê·¸ì•„ì›ƒ</a>
                        <a href="/customer/"> ë§ˆì´í˜ì´ì§€</a>
                        <a href="/customer/basket"> ì¥ë°”êµ¬ë‹ˆ</a>
                    </div><!-- íšŒì›ë¡œê·¸ì¸ì‹œ -->

                    <div th:if="${session.storeLoginEmail}">
                        <a href="/usual/logout">ë¡œê·¸ì•„ì›ƒ</a>
                        <a th:href="@{|/store/menuControl/${session['storeLoginEmail']}|}">ë©”ë‰´ê´€ë¦¬</a>
                        <a th:href="@{|/store/orderAll/${session['storeLoginEmail']}|}"> ì£¼ë¬¸ê´€ë¦¬</a>
                        <a href="/storeMain"> ìŠ¤í† ì–´ê´€ë¦¬ </a>
                    </div><!-- ì—…ì²´ë¡œê·¸ì¸ì‹œ -->
                </span>
            </div>
            <div class="col" id="menuBar-friPan">
                <a href="#" class="btn btn-light btn-sm " tabindex="-1" role="button" aria-disabled="true">ğŸ³</a>
            </div>
        </div>
    </div>
</header><!--header ìˆ˜ì •ì™„ë£Œ-->
<section>
    <div class="container-section-store">
        <form class="row" id="store">
            <div id="storeDataView">
                <div id="sAll">
                    <div id="sImage">
                        <img th:src="@{|/upload/store/${storeList.getStoreFilename()}|}" alt="ì‚¬ì§„" width="200px" ;
                             height="200px">
                    </div>
                    <div id="sInfo">
                        <h2><span id="storeInfo" th:text="${storeList.storeName}"></span></h2><br>
                        ì£¼ì†Œ:
                        <td th:text="${storeList.storeAddress}"></td>
                        <br>
                        ì—°ë½ì²˜:
                        <td th:text="${storeList.storePhone}"></td>
                        <br>
                        ì˜¤í”ˆì‹œê°„:
                        <td th:text="${storeList.storeOpen}"></td>
                        ë§ˆê°ì‹œê°„:
                        <td th:text="${storeList.storeClose}"></td>
                        <br>

                        <button th:onclick="wishlist_add_btn([[${storeList.storeNumber}]])">ğŸ˜˜</button>
                        <td th:text="${storeList.storeWish}"></td>
                    </div>
                </div>
                <div id="mrBtn">
                    <a class="btn btn-Light" tabindex="-1" role="button" id="menuBtn" style="background-color: coral"
                       onclick="MenuBtn()"> ë©”ë‰´ </a>
                    <a class="btn btn-Light" tabindex="-1" role="button" id="reviewBtn" style="background-color: coral"
                       onclick="reviewBtn()"> ë¦¬ë·° </a>
                    <!--<button onclick="MenuBtn()"> ë©”ë‰´</button>
                    <button onclick="reviewBtn()"> ë¦¬ë·°</button>-->
                </div>
            </div>
        </form>
        <div id="menuArea">
            <table class="table table-warning table-hover">
                <thead>
                <th> ì‚¬ì§„</th>
                <th> ë©”ë‰´</th>
                <th> ì„¤ëª…</th>
                <th> ê°€ê²©</th>
                <th> ë‹´ê¸°</th> <!-- ì£¼ë¬¸í•˜ëŠ” ë²„íŠ¼ìœ¼ë¡œ í•´ì•¼í•˜ë‚˜ìš”? ?????-->
                </thead>
                <tbody>
                <tr th:each="menu: ${menuList}">
                    <th><img th:src="@{|/upload/store/${menu.menuFilename}|}" alt="ì‚¬ì§„" width="100px" ; height="100px">
                    </th>
                    <td th:text="${menu.menuName}"></td>
                    <td th:text="${menu.menuExplain}"></td>
                    <td th:text="${menu.menuPrice}"></td>
                    <td>
                        <!-- Button trigger modal -->
                        <button type="button" class="btn btn-warning btn-sm" data-bs-toggle="modal"
                                data-bs-target="#exampleModal"
                                th:onclick="basket_view([[${menu.menuNumber}]])">
                            ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸°
                        </button>
                    </td>
                    <td th:hidden="${menu.storeNumber}"></td>
                    <td th:hidden="${menu.storeCategoryName}"></td>
                </tr>
                </tbody>
            </table>
        </div>
        <div class="contents" id="reviewArea" style="display: none">
            <div class="rv" th:each="r:${reviewList}">
                <div class="row" id="reviewArea1">
                    <div id="review1">
                        <div id="3">
                        <span th:each="menu : ${r.reviewFileDTOList}">
                            <span><img th:src="@{|/upload/review/${menu.reviewFilename}|}" alt="ì‚¬ì§„ì‹¤ì¢…ë¨" width="220px"
                                       height="150px"></span>
                        </span>
                        </div>
                    </div>
                    <div id="review2">
                        <div class="t012">
                            <div id="1"><h3><span th:text="${r.customerName}"></span>ë‹˜</h3></div>
                            <div id="2"><span id="time" th:text="${r.reviewTime}"></span></div>
                        </div>
                        <div id="4">
                            <div>
                                <span th:text="${r.reviewScore}"></span>ì  ì£¼ì…¨ìŠµë‹ˆë‹¤.
                                <h5><span th:if="${r.reviewScore.toString().equals('5')}">ğŸ—ğŸ—ğŸ—ğŸ—ğŸ—</span></h5>
                                <h5><span th:if="${r.reviewScore.toString().equals('4')}">ğŸ—ğŸ—ğŸ—ğŸ—</span></h5>
                                <h5><span th:if="${r.reviewScore.toString().equals('3')}">ğŸ—ğŸ—ğŸ—</span></h5>
                                <h5><span th:if="${r.reviewScore.toString().equals('2')}">ğŸ—ğŸ—</span></h5>
                                <h5><span th:if="${r.reviewScore.toString().equals('1')}">ğŸ—</span></h5>
                            </div>
                            <span th:text="${r.menuName}"></span>ë¥¼ ì‹œí‚¤ì…¨ë„¤ìš”!<br>
                            <hr class="line">
                            <span th:text="${r.reviewComments}"></span>
                        </div>
                    </div>
                </div>
                <div class="row" id="commentArea">
                    <h5><span> ì‚¬ì¥ë‹˜ ë‹µê¸€ </span></h5>
                    <div th:if="${r.replyDetailDTO != null}">
                        <p class="ment" th:text="${r.replyDetailDTO.replyContents}"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">ğŸ™ Eating together!</h5>
                    <button type="button" class="btn-close" id="modal_close" data-bs-dismiss="modal"
                            aria-label="Close"></button>
                </div>
                <div class="modal-body" id="modal-body">
                    ...
                </div>
                <!--<div class="modal-footer">
                    <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">ë‹«ê¸°</button>
                    <button type="button" class="btn btn-info btn-sm">ë‹´ê¸°</button>
                </div>-->
            </div>
        </div>
    </div>
    <div id="msgStack"></div>
</section>
</body>
<script src="/js/webSocket.js"></script>
<script>

    function MenuBtn() {
        $("#menuArea").show();
        $("#reviewArea").hide();
        console.log("ë©”ë‰´ë²„íŠ¼ í´ë¦­");
    }

</script> <!-- ë©”ë‰´ë²„íŠ¼ í´ë¦­ -->
<script>
    const reviewBtn = () => {
        console.log("ë¦¬ë·°ë²„íŠ¼ í´ë¦­")
        $("#reviewArea").show();
        $("#menuArea").hide();
    };
</script> <!-- ë¦¬ë·°ë²„íŠ¼ í´ë¦­-->
</html>